/* 
 * @packet blog.images;
 * @require blog.util.file;
 * @template blog.template.images;
 * @css blog.style.images:bb;
 */Module({name:"imagesuploader",className:"imagesuploader",extend:"view",option:{url:basePath+"admin/api/addarticle",filename:"file",label:"upload image",height:"300px"},template:module.getTemplate("@images","imagesuploader"),init:function(){this._file=null,this.render(this.option)},bind_file:function(e,i){var a=this,s=i.target.files||i.dataTransfer.files,d=require("@file").set(s[0]),l=!1;this._file&&this._file.fileName===d.fileName()&&(l=!0),l||(this.dom.find(".imagesuploader-image").remove(),d.getImage(function(e){var i=e.width/e.height*150,s=0,l=0;150>=i?s=(150-i)/2:(_h=e.height/e.width*150,_h<=150&&(l=(150-_h)/2)),t=d.fileName().split("/");var r="<div class='imagesuploader-image'><div class='imagesuploader-image-bg' style='background-image:url("+e.src+")'></div><div class='imageuploader-name' title='"+t[t.length-1]+"'>"+t[t.length-1]+"</div><div class='imageuploader-progress'></div></div>",o=$(r).insertBefore(a.dom.find(".imagesuploader-container").children(0));this._dom=o}),this._file=d)},setImage:function(e){this.dom.find(".imagesuploader-image").remove();var i="<div class='imagesuploader-image'><div class='imagesuploader-image-bg' style='background-image:url("+e+")'></div><div class='imageuploader-name' title=''>"+e+"</div><div class='imageuploader-progress'></div></div>";$(i).insertBefore(this.dom.find(".imagesuploader-container").children(0))},upload:function(e,i,a){var t=this;this._file?this._file.upload({url:t.option.url,name:"file",asysn:!0,data:e,out:6e6,progress:function(e){t.dom.find(".imageuploader-progress").width(e.percent+"%")},error:function(e){a&&a(e)},success:function(e){t.dom.find(".imageuploader-progress").width(0),i&&i(e.data)}}):this.postRequest(this.option.url,e).data(function(e){i&&i(e)}).bad(function(){a&&a()}).error(function(){a&&a()})}});